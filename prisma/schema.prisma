generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql" // Đã xác nhận lại là PostgreSQL
  url      = env("DATABASE_URL")
}

// --- ENUMS ---
enum Role {
  BUYER
  SELLER
  ADMIN
}

// --- MODELS ---

model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  password  String
  fullName  String
  role      Role     @default(BUYER)
  createdAt DateTime @default(now())

  // Relations
  shop    Shop?
  orders  Order[]
  reviews Review[]
}

model Shop {
  id          Int     @id @default(autoincrement())
  ownerId     Int     @unique
  name        String
  description String? // Câu chuyện nghệ nhân
  isVerified  Boolean @default(false)
  
  owner    User      @relation(fields: [ownerId], references: [id])
  products Product[]
}

model Product {
  id            Int      @id @default(autoincrement())
  shopId        Int
  name          String
  description   String   @db.Text
  
  // RÚT GỌN: Lưu dạng String để đơn giản hóa
  category      String   // VD: "Gốm sứ"
  material      String?  // VD: "Đất nung"
  origin        String?  // VD: "Bát Tràng"
  
  // POSTGRESQL: Dùng Decimal để tính tiền chính xác
  price         Decimal  @db.Decimal(15, 2) 
  stockQuantity Int      @default(0)
  soldCount     Int      @default(0)
  createdAt     DateTime @default(now())

  shop       Shop        @relation(fields: [shopId], references: [id])
  reviews    Review[]    
  orderItems OrderItem[]
}

model Order {
  id            Int      @id @default(autoincrement())
  userId        Int
  
  // POSTGRESQL: Dùng Decimal
  totalAmount   Decimal  @db.Decimal(15, 2)
  status        String   @default("PENDING") 
  
  // RÚT GỌN: Địa chỉ lưu string
  address       String   
  phone         String
  createdAt     DateTime @default(now())

  user       User        @relation(fields: [userId], references: [id])
  orderItems OrderItem[]
}

model OrderItem {
  id        Int     @id @default(autoincrement())
  orderId   Int
  productId Int
  quantity  Int
  price     Decimal @db.Decimal(15, 2) // Giá lúc mua

  order   Order   @relation(fields: [orderId], references: [id])
  product Product @relation(fields: [productId], references: [id])
}

model Review {
  id        Int      @id @default(autoincrement())
  userId    Int
  productId Int
  rating    Int      @default(5)
  comment   String?
  createdAt DateTime @default(now())

  user    User    @relation(fields: [userId], references: [id])
  product Product @relation(fields: [productId], references: [id])
}